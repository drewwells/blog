
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>sessionStorage localStorage - Tales from a JavaScript Developer</title>
  <meta name="author" content="Drew Wells">

  
  <meta name="description" content="One common problem with JavaScript applications is saving data between page refreshes.  HTML5 solves this with the Storage interface.  This is not ...">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://drewwells.net/blog/2010/sessionstorage-localstorage/">
  <link href="/blog/favicon.png" rel="icon">
  <link href="/blog/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/blog/javascripts/modernizr-2.0.js"></script>
  <script src="/blog/javascripts/ender.js"></script>
  <script src="/blog/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/blog/atom.xml" rel="alternate" title="Tales from a JavaScript Developer" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/blog/">Tales from a JavaScript Developer</a></h1>
  
    <h2>Practicing JavaScript ninja</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/blog/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:drewwells.net/blog" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul class="main-navigation">
  <li><a href="/blog/">Blog</a></li>
  <li><a href="/blog/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">sessionStorage localStorage</h1>
    
    
      <p class="meta">
        





  



<time datetime="2010-04-12T23:11:05-04:00" pubdate  data-updated="true" >Apr 12<span>th</span>, 2010</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>One common problem with JavaScript applications is saving data between page refreshes.  HTML5 solves this with the Storage interface.  This is not to be confused with Mozilla&#8217;s now ObsoleteStorage interface and globalStorage, which while supported in Mozilla is not part of the <a href="http://www.w3.org/TR/webstorage/#contents">w3 Standard</a>.</p>

<p><strong>Storage Interface</strong>
The interface is incredibly easy to use, the Storage interface defines two attributes (and an event): sessionStorage and localStorage.</p>

<p>Storage Interface definition:</p>

<blockquote>Each Storage object is associated with a list of key/value pairs when it is created, as defined in the sections on the sessionStorage and localStorage attributes. Multiple separate objects implementing the Storage interface can all be associated with the same list of key/value pairs simultaneously.</blockquote>


<p><strong>sessionStorage</strong>
Per the w3 standard,</p>

<blockquote>Sites can add data to the session storage, and it will be accessible to any page from the same site opened in that window.</blockquote>


<p>This means that data can be stored in a uniform object and retrieved only from within that window/tab and for the site defined.  These structures are also deleted when the browser is closed, except if the browser crashes in which the object is restored.  The actual data is scoped to a HTML5 origin (scheme + hostname + non-standard port).  This means https://google.com and http://google.com can not access each others localStorage.</p>

<p>Mozilla gives a good example of a use case for this.  Saving a text field in the event that their browser crashes, which would restore any data in that text field when the browser recovers.</p>

<p><strong>localStorage</strong>
The localStorage attribute of Storage is a different beast.  It follows the same basic concept, objects are stored in the HTML5 origin (scheme + hostname + non-standard port).  The difference being that these values are stored forever, surviving browser closing.</p>

<p>Currently, webkit/mozilla allow 5megs of globalStorage and IE allows 10megs.  You can see this is high use in your HTML5 web browsers after opening applications like GMail or Facebook.  One thing to note, if you overfill the space, the w3 standard defines an error is thrown.  So be sure to maintain your space, and wrap storage attempts in a try/catch. w3: <em>&#8220;If it couldn&#8217;t set the new value, the method must raise an QUOTA_EXCEEDED_ERR exception. (Setting could fail if, e.g., the user has disabled storage for the site, or if the quota has been exceeded.)&#8221;</em></p>

<p><strong>Implementation</strong>
The first thing I did was start throwing structures in the localStorage.  I can&#8217;t think of a reason I would want to put just key/value pairs in there.  So here&#8217;s my code:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">sessionStorage</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>  <span class="s1">&#39;query1&#39;</span><span class="o">:</span> <span class="s1">&#39;apple&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="s1">&#39;query2&#39;</span><span class="o">:</span> <span class="s1">&#39;banana&#39;</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>I thought, now how do I extract these values back out.  Here&#8217;s my first go:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">sessionStorage</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="s1">&#39;query1&#39;</span><span class="p">];</span> <span class="p">);</span> <span class="c1">//undefined</span>
</span></code></pre></td></tr></table></div></figure>


<p>Undefined? but why!  I inspected the storage in firebug here&#8217;s what was stored to sessionStorage:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="s2">&quot;[object Object]&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The w3 standard does not define anything beyond the fact that the Storage Interface stores key/value pairs via the setter method.  I can only postulate that it runs .toString() on anything with a typeof !== &#8216;string&#8217;.  So, how do we store complex values in sessionStorage?  Easy, use JSON.</p>

<p>Normally you deal with json in this fashion.  Using <a href="http://www.json.org/js.html">Crockford&#8217;s JSON2</a> or native browser implementation.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="s2">&quot;{&#39;query1&#39;: &#39;apple&#39;, &#39;query2&#39;: &#39;banana&#39;}&quot;</span><span class="p">);</span>  <span class="c1">//object with query1 and query2 properties</span>
</span></code></pre></td></tr></table></div></figure>


<p>However, this is the opposite of what we want.  We want to take an object and make a string out of it, enter <em>stringify</em>.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">querySet</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>  <span class="s1">&#39;query1&#39;</span><span class="o">:</span> <span class="s1">&#39;apple&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="s1">&#39;query2&#39;</span><span class="o">:</span> <span class="s1">&#39;banana&#39;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">string</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">querySet</span><span class="p">);</span>
</span><span class='line'><span class="c1">//Now store this string in sessionStorage</span>
</span><span class='line'><span class="nx">sessionStorage</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">string</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">originalResult</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span> <span class="nx">sessionStorage</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">]</span> <span class="p">);</span> <span class="c1">//original object with query1 and query2 attributes</span>
</span></code></pre></td></tr></table></div></figure>


<p>I do not know if this is the preferred way, but since JSON is an integral part of client/storage data communication.  I can only see it lending itself nicely to application/browser data communication as well.</p>

<p>Happy storing data on the browser, I&#8217;m sure your users will enjoy the speed and resilience of your applications.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">admin</span></span>

      





  



<time datetime="2010-04-12T23:11:05-04:00" pubdate  data-updated="true" >Apr 12<span>th</span>, 2010</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://drewwells.net/blog/2010/sessionstorage-localstorage/" data-via="coldfuser" data-counturl="http://drewwells.net/blog/2010/sessionstorage-localstorage/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
</div>

    
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2011/my-adventures-into-webgl/">My adventures into WebGL</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/jodoc-js/">jodoc-js</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/testing-for-optional-false-params-in-javascript/">Testing for optional false params in JavaScript</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/github/">Github</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/hp-pavilion-dv6-quad-edition/">HP Pavilion dv6 Quad Edition</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Github Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/drewwells">@drewwells</a> on Github
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'drewwells',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/blog/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("coldfuser", 4, false);
    });
  </script>
  <script src="/blog/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/coldfuser" class="twitter-follow-button" data-width="208px" data-show-count="false">Follow @coldfuser</a>
  
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2011 - Drew Wells -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
    var disqus_shortname = 'drewwells';

      
        
        var disqus_script = 'count.js';
      

    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>



  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-2783646-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>





</body>
</html>
