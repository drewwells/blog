
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Tales from a JavaScript Developer</title>
  <meta name="author" content="Drew Wells">

  
  <meta name="description" content="So I have been pretty busy trying to get into WebGL.  It is easily the best way to have a bad time in programming right now.  The combination of ex...">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://drewwells.net/blog/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Tales from a JavaScript Developer" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Tales from a JavaScript Developer</a></h1>
  
    <h2>Practicing JavaScript ninja</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:drewwells.net/blog" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/my-adventures-into-webgl/">My Adventures Into WebGL</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2011-09-30T00:04:49-04:00" pubdate  data-updated="true" >Sep 30<span>th</span>, 2011</time>
        
         | <a href="/2011/my-adventures-into-webgl/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>So I have been pretty busy trying to get into WebGL.  It is easily the best way to have a bad time in programming right now.  The combination of experimental browser support, bad linux drivers, and JavaScript&#8217;s direct mapping to very old C code made it quite difficult.</p>

<p>I started by looking at a <a href="http://learningwebgl.com/blog/?page_id=1217">Learning WebGL</a>.  I 100% recommend this especially if you are unfamiliar with the domain.  Why would you keep reading this if you weren&#8217;t?  If you go through these lessons copy/pasting code, you will think this is simple.  However, the first thing I tried was tweaking things.</p>

<p>Who wants a pyramid?  I made a triangle cube.
Who wants a cube with solid color sides?  So, I made a cube with blending (gradients).</p>

<p>The first thing I noticed, you ever heard of perma-death games?  One typo, one vertex without a color and the whole thing fails to load.  There&#8217;s no 1%, 50%, or even 99% working it&#8217;s all or nothing.  So, much of my time was debugging the tiniest details of my application.</p>

<p>One time, I spent two hours drawing and staring of my 3d object on a piece of paper.  It actually didn&#8217;t help at all, the real problem was totally unrelated.  I think maybe paper helps those people either with super complex or super simple problems.  Mine was a problem of misunderstanding so staring at a 3d model on a 2d piece of paper did not help me.</p>

<p>So I will go into the most basic details here.  What is WebGL and why is canvas so much better?  Let&#8217;s say I want to draw a square.</p>

<p>I define my 4 points and tell OpenGL to go draw it.  OpenGL says go fly a kite.  OpenGL only understands triangles.  There are two ways to do this.  A triangle for every 3 vertices (gl.TRIANGLES), or one triangle, then every subsequent point forms a new triangle (gl.TRIANGLE_STRIP).  Obviously, the second one is ideal as it is far more efficient on the GPU to reuse existing vertices.  However, if you use the strip it will treat every new point as the foundation of the next triangle.  This can cause significant problems if you want to connect vertex 3 to vertext 7 and 8.  You can get some really crazy shapes that made my brain hurt looking at them.</p>

<p>Next post, I will start getting into the code behind <a href="http://drewwells.github.com/webglfu/graph.html">Graph 3d</a> and try to justify the few dozen hours I lost working on it.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/jodoc-js/">Jodoc-js</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2011-09-22T15:42:02-04:00" pubdate  data-updated="true" >Sep 22<span>nd</span>, 2011</time>
        
         | <a href="/2011/jodoc-js/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>So it&#8217;s about time to post an update on things I&#8217;m working on lately which have been a lot, just look at my github feed: https://github.com/drewwells</p>

<p>Today I want to talk a bit about the documentation framework we are now using at work. It&#8217;s rather fantastic and based on a python implementation: https://github.com/davebalmer/joDoc.  It hasn&#8217;t been updated at all this year, but azakus has ported the whole thing to NodeJS!</p>

<p>The idea is quite simple, take markdown based comments in your JavaScript file and throw them into a web page. How hard was that? No complicated syntax, no huge comment blocks to facilitate special formatting. KISS.</p>

<p>So!</p>

<h3>What does this thing do, and why should you care?</h3>

<p>First off markdown knowledge would be good to know. You have two paths here</p>

<p>I know markdown, but rusty on syntax <a href="http://drewwells.github.com/showdown/example/">Try my demo</a>
I don&#8217;t know markdown give me the <a href="http://daringfireball.net/projects/markdown/">Full details</a></p>

<p>Sample JavaScript file</p>

<p>file.js</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"># file.js</span>
</span><span class='line'><span class="cm">Some information about the file.  The h1 above is</span>
</span><span class='line'><span class="cm">## main</span>
</span><span class='line'>
</span><span class='line'><span class="cm">Hey what is this, C code?</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">main</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="s1">&#39;I am not C code, see &#39;</span> <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>So, thanks to the /** part you will get a big h1 tag with &#8216;file.js&#8217; which also acts as the index.  Anywhere you link to [file.js] now links to the html page created for file.js.</p>

<p>There are two forms created, single file where links use hash tags to find documentation, or multi page where each html page is run through a template and an entire page with header links is provided.</p>

<p>Fring features: I have been adding cool features to it which can be found in &#8216;joapp-experiment&#8217;.  I&#8217;m working with the owner to get these integrated into his repository.</p>

<h3>File based configuration</h3>


<p>Currently, you must maintain complicated command line scripts to use it.  Why must it be so?  It&#8217;s great to put these in a build tool, but sometimes you want to set it and forget it.  So I have implemented via &#8216;require()&#8217;, Node 0.3.0+ I think, to require a separate file.  This is cool, because those files can require other files say to provide a dist and a dev version of your docs &lt;3 require().</p>

<p>I made a pull request for this feature on 9/8 and here it is 2 weeks later without even a comment: https://github.com/azakus/jodoc-js/pull/10. It includes a demo since I properly commented jodoeJS itself to dogfood and provide an easy demo for others.  There are notes on how to use this in the README.</p>

<h3>Serve the docs via NodeJS as a web page</h3>


<p>It&#8217;s cool that the docs run in NodeJS b/c they are sub second fast.  But why do I need to run a build command to get them going?  Can&#8217;t NodeJS serve to a browser instead?  The answer is Yes it can.  So I wrote a small web server inside the app.  It has no dependencies, so it&#8217;s very simple and dumb.  I had to add proper mime-types for picky browsers like Chrome.</p>

<p>As the HTML is created, it is sent to the browser by hitting the URL in your browser.  It can also serve the files created on disk, but way less cool.  Oh did I mention, it will reparse all your source files before doing so?  So, if you are actively writing documentation just hit refresh to see your changes.  It couldn&#8217;t be simpler.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/testing-for-optional-false-params-in-javascript/">Testing for Optional False Params in JavaScript</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2011-08-08T15:10:30-04:00" pubdate  data-updated="true" >Aug 8<span>th</span>, 2011</time>
        
         | <a href="/2011/testing-for-optional-false-params-in-javascript/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Sounds like a silly thing, but sometimes you want optional false parameters.  If for nothing else than to make your parameters human readable, not just syntactically convenient.</p>

<p>So let&#8217;s start out:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">//blur: false</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="o">!</span><span class="nx">config</span><span class="p">.</span><span class="nx">blur</span> <span class="c1">//Oh noes reports true</span>
</span></code></pre></td></tr></table></div></figure>


<p>The trick here is to detect whether the variable is undefined, then for it&#8217;s truthy value.  Fixed implementation:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="k">if</span><span class="p">(</span> <span class="nx">config</span><span class="p">.</span><span class="nx">blur</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;</span><span class="nx">amp</span><span class="p">;</span><span class="o">&amp;</span><span class="nx">amp</span><span class="p">;</span> <span class="o">!</span><span class="nx">config</span><span class="p">.</span><span class="nx">blur</span> <span class="p">){</span>
</span><span class='line'>  <span class="c1">//Won&#39;t execute != null is false</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nx">config</span><span class="p">.</span><span class="nx">blur</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span><span class="p">(</span> <span class="nx">config</span><span class="p">.</span><span class="nx">blur</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;</span><span class="nx">amp</span><span class="p">;</span><span class="o">&amp;</span><span class="nx">amp</span><span class="p">;</span> <span class="o">!</span><span class="nx">config</span><span class="p">.</span><span class="nx">blur</span> <span class="p">){</span>
</span><span class='line'>  <span class="c1">//Logic executes</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Pretty cool huh?  Test with if/else structures or you will get errors.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/github/">Github</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2011-07-19T21:04:35-04:00" pubdate  data-updated="true" >Jul 19<span>th</span>, 2011</time>
        
         | <a href="/2011/github/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>As someone that isn&#8217;t afraid to get his hands dirty, I find Github to be a god send.  It really makes coding a dream, and it makes collaborative coding amazingly easy.</p>

<p>The current project I&#8217;m working on involves nearly a dozen libraries.  There&#8217;s a huge difference between those on Github and those hosted else where.  For one, the code hosted else where just sits in my lib directory.  I make modifications to it and commit to our internal version control system (Perforce).  If I want to commit those back it nearly always ends up being an arduous process of building diff files and going through a multi-week issue/communication with an author.</p>

<p>Now flip over to Github, let&#8217;s say there&#8217;s a minor issue with a particular feature.  I open an issue and the author is notified via email.  The next day that feature may get fixed.  Even if it isn&#8217;t, I fork the code base and make my own.  That&#8217;s how my dashboard is now almost  <a href="http://github.com/drewwells">30 repositories full</a>.  I have no qualms getting in there and hacking away at some things.  More often than not I learn 10 things for every one I bring to the table.  It&#8217;s incredibly rewarding and I thank Github for this.</p>

<p>Github provide an amazing service to the world and the betterment of developer kind.  I owe much of my working knowledge to Github committing code, reading code, and learning code from them.</p>

<p>My latest projects include in no particular order:
<a href="http://drewwells.github.com/fonttest/">Fonttest</a> enumerates the 30+ font&#8217;s from the excellent M+ non-web fonts, I&#8217;m working on WOFFing, EOTing them via <a href="http://fontsquirrel.com">FontSquirrel</a>.  This is also my first start at Github Pages, and it is totally amazing as usual.
<a href="http:/drewwells.github.com/jsdoc-js/">jodoc-js</a> This is a port from the amazing jodoc perl library.  It allows standard markdown and scraping of JavaScript of files.  I&#8217;m working to improve the Table of Contents building and automagic link building.  I&#8217;m heavily considering starting fresh with a new repository to reduce some of the technical debt.</p>

<p>On a side note, don&#8217;t you wish you could EMACS the world?  How many times do I ctrl+s, ctrl+b a day in the web browser and end up with some crazy shit going on :(</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/hp-pavilion-dv6-quad-edition/">HP Pavilion Dv6 Quad Edition</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2011-07-03T01:16:03-04:00" pubdate  data-updated="true" >Jul 3<span>rd</span>, 2011</time>
        
         | <a href="/2011/hp-pavilion-dv6-quad-edition/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>My new laptop is wonderful and great.  It&#8217;s also completely a pos in Ubuntu.  Number one problem is the brightness level in Linux, it&#8217;s always 100% and it can&#8217;t be modified by the keyboard, or even /sys properties.  However, the magical xrandr can fix it.</p>

<p>In integrated graphics mode: use xrandr as so</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">xrandr</span> <span class="o">--</span><span class="nx">output</span> <span class="nx">LVDS1</span> <span class="o">--</span><span class="nx">brightness</span> <span class="mf">0.4</span>
</span></code></pre></td></tr></table></div></figure>


<p>I made a script to use make this a little more automated:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">xrandr</span> <span class="o">--</span><span class="nx">output</span> <span class="nx">LVDS1</span> <span class="o">--</span><span class="nx">brightness</span> <span class="nx">$1</span>
</span></code></pre></td></tr></table></div></figure>


<p>Save it to brightness.sh (no sudo required on my system).</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="p">.</span><span class="o">/</span><span class="nx">brightness</span><span class="p">.</span><span class="nx">sh</span> <span class="mf">0.7</span>
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/leaflet/">Leaflet</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2011-05-18T22:48:08-04:00" pubdate  data-updated="true" >May 18<span>th</span>, 2011</time>
        
         | <a href="/2011/leaflet/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This is just a quick post, I&#8217;m working on putting together a demo using <a href="http://leaflet.cloudmade.com/">Leaflet</a>.  I&#8217;m curious if it has the necessary features to port Craigmaps to it, then I will finally have something that runs on mobile devices and can find a new place to live on the go!  Anyways, quick demo <a href="http://drewwells.net/leaflet/demo/">here</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/syntaxhighlighter-evolved-is-broken/">SyntaxHighlighter Evolved Is Broken</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2011-03-02T18:01:13-05:00" pubdate  data-updated="true" >Mar 2<span>nd</span>, 2011</time>
        
         | <a href="/2011/syntaxhighlighter-evolved-is-broken/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I apologize all of the code of my posts now is completely unformatted and missing syntax highlighting.  I have looked into the problem numerous times, and fixed it numerous times.  It usually involves removing and re-adding the plugin or doing other things.  I am now very annoyed there has been no update to the reason syntax highlighter will stop working after a few days, weeks.</p>

<p>I am looking for a new one, preferably one that will not break every couple of days.  I will have to go back through all of my posts and update the syntax to this new highlighter.</p>

<p>Don&#8217;t use this plugin: <a href="http://www.viper007bond.com/wordpress-plugins/syntaxhighlighter/">SyntaxHighlighter Evolved</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/craigmaps/">Craigmaps</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2011-02-05T18:12:40-05:00" pubdate  data-updated="true" >Feb 5<span>th</span>, 2011</time>
        
         | <a href="/2011/craigmaps/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Quick post, I finally got Craigmaps generally stable.  It&#8217;s a huge series of ajax calls on average 150.  This could use some fine tuning or caching.  Try it out <a href="http://drewwells.net/craigmaps/">Craigmaps</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/better-know-javascript-google-static-map/">Better Know JavaScript - Google Static Map</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2011-01-18T20:17:57-05:00" pubdate  data-updated="true" >Jan 18<span>th</span>, 2011</time>
        
         | <a href="/2011/better-know-javascript-google-static-map/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&#8217;ve decided to start exploring JavaScript &#8211;not frameworks ontop of JavaScript&#8211; in order to better understand what I use but do not understand.  First candidate: <a href="http://www.coldfusionjedi.com/index.cfm/2011/1/5/Creating-map-previews-with-jQuery-and-Googles-Static-Map-API">Creating-map-previews-with-jQuery-and-Googles-Static-Map-API</a></p>

<p>My job is not to directly emulate what is going on in Ray&#8217;s Post, but to explore ways to do this in just JavaScript no pesky script tags above your raw code.  The only tricky part is tracking onkeyup, I refer to <a href="http://www.quirksmode.org/js/keys.html">http://www.quirksmode.org/js/keys.html</a>for browser compliance.</p>

<p>Here she goes!</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="o">&lt;</span><span class="nx">textarea</span> <span class="nx">cols</span><span class="o">=</span><span class="s2">&quot;30&quot;</span> <span class="nx">rows</span><span class="o">=</span><span class="s2">&quot;2&quot;</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;address&quot;</span><span class="o">&gt;</span><span class="nx">Type</span> <span class="nx">address</span> <span class="nx">here</span><span class="o">&lt;</span><span class="err">/textarea&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">br</span><span class="o">/&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">img</span> <span class="nx">width</span><span class="o">=</span><span class="s2">&quot;400&quot;</span> <span class="nx">height</span><span class="o">=</span><span class="s2">&quot;400&quot;</span> <span class="nx">title</span><span class="o">=</span><span class="s2">&quot;Map!&quot;</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;map&quot;</span> <span class="o">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">base</span> <span class="o">=</span> <span class="s2">&quot;http://maps.google.com/maps/api/staticmap?zoom=12&quot;</span> <span class="o">+</span>
</span><span class='line'>    <span class="s2">&quot;&amp;size=400x400&amp;maptype=roadmap&amp;sensor=false&amp;center=&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">map</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;map&quot;</span><span class="p">),</span>
</span><span class='line'>    <span class="nx">area</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;address&quot;</span><span class="p">),</span>
</span><span class='line'>    <span class="nx">virgin</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nx">area</span><span class="p">.</span><span class="nx">onfocus</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ev</span><span class="p">){</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span> <span class="nx">virgin</span> <span class="p">){</span>  <span class="c1">//Touched for the very first time?</span>
</span><span class='line'>    <span class="nx">virgin</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nx">area</span><span class="p">.</span><span class="nx">onkeyup</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ev</span><span class="p">){</span>
</span><span class='line'>  <span class="c1">//All sorts of broken things with detecting keycodes,</span>
</span><span class='line'>  <span class="c1">//I&#39;m just looking for value</span>
</span><span class='line'>  <span class="nx">map</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">4</span> <span class="o">?</span> <span class="nx">base</span> <span class="o">+</span> <span class="nx">escape</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="p">})();</span>
</span></code></pre></td></tr></table></div></figure>


<p>However, <a href="http://drewwells.net/demo/static-google-map.html">seeing is believing</a></p>

<p>This should work in all browsers, I don&#8217;t have Windows to test this though :)</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/nodejs-proxy-to-simplify-iws-api/">NodeJS Proxy to Simplify IWS API</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2011-01-03T12:42:34-05:00" pubdate  data-updated="true" >Jan 3<span>rd</span>, 2011</time>
        
         | <a href="/2011/nodejs-proxy-to-simplify-iws-api/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Normally I learn a new platform by painfully doing some file operations in that language.  This is a good way to find out about some of the languages ability to provide synatic sugar atop bad APIs, but a poor way to explore the language.</p>

<p>Fortunately, I found a great use for node js.  Our corporate server technology is very behind on REST.  So I wanted to build a proxy server to convert their API into a RESTful or as RESTful as possible API.</p>

<p>First step was finding a way to create a HTTP proxy.  This can be done with <a href="http://www.catonmat.net/http-proxy-in-nodejs">20 lines of code in Node JS</a>.  However, this is pretty ghetto and I want to do this with a nice API and just one line of code, something like
proxy( port, domain, request, response ).</p>

<p>I found just that here: <a href="https://github.com/nodejitsu/node-http-proxy">https://github.com/nodejitsu/node-http-proxy</a>.</p>

<p>Now, let&#8217;s look at some code</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">),</span>
</span><span class='line'>     <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(),</span>
</span><span class='line'>     <span class="nx">httpProxy</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http-proxy&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;/iws/*&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">res</span><span class="p">){</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">proxy</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">httpProxy</span><span class="p">.</span><span class="nx">HttpProxy</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">res</span><span class="p">);</span>
</span><span class='line'>   <span class="nx">proxy</span><span class="p">.</span><span class="nx">proxyRequest</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="s1">&#39;iws.erdas.com&#39;</span><span class="p">,</span> <span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>This will look for requests on /iws/, I&#8217;m using <a href="http://expressjs.com/">express</a> for easier routing, then proxy those to iws.erdas.com.  The requests are automatically sent back to the user.</p>

<p>This isn&#8217;t what I set out to do.  I wanted to simplify the API, so I looked over at ARCGIS REST services and went from there.</p>

<p>So, I will be taking this:</p>

<pre><code>http://iws.erdas.com/ImageX/imagex.dll?image?cache=true&amp;transparent=true
&amp;fill=ffffff&amp;quality=60&amp;type=jpg&amp;l=2&amp;tx=2&amp;ty=1&amp;ts=256&amp;
layers=/sampleiws/images/geodetic/usademo.ecw&amp;srs=EPSG:4326
</code></pre>

<p>and turning it into this:</p>

<pre><code>http://localhost:3000/iws/map/sampleiws/images/geodetic/usademo.ecw/2/2/1/
</code></pre>

<p>Now the how:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="sr">/^\/iws\/map\/?([^?]+)?(.+)?/</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">res</span><span class="p">){</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">proxy</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">httpProxy</span><span class="p">.</span><span class="nx">HttpProxy</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">),</span>
</span><span class='line'>  <span class="nx">captures</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span> <span class="sr">/^\/iws\/map\/?([^?]+)?(.+)?/</span> <span class="p">),</span>
</span><span class='line'>        <span class="nx">layer</span> <span class="o">=</span> <span class="p">(</span> <span class="nx">captures</span> <span class="o">&amp;&amp;</span> <span class="nx">captures</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nx">captures</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>  <span class="c1">//bug requires prependend /</span>
</span><span class='line'>  <span class="nx">qstring</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">tile</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span> <span class="sr">/\/\d+\/\d+\/\d+\//</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">layer</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">layer</span> <span class="o">=</span> <span class="nx">layer</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\/\d+\/\d+\/\d+\//</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">substr</span><span class="p">,</span> <span class="nx">offset</span><span class="p">){</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">tile</span> <span class="o">=</span> <span class="nx">substr</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/\d+/g</span><span class="p">);</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">substr</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">substr</span><span class="p">.</span><span class="nx">length</span> <span class="p">);</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">qstring</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&amp;l=&#39;</span><span class="p">,</span>
</span><span class='line'>         <span class="nx">tile</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span class='line'>         <span class="s1">&#39;&amp;tx=&#39;</span><span class="p">,</span>
</span><span class='line'>         <span class="nx">tile</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span class='line'>         <span class="s1">&#39;&amp;ty=&#39;</span><span class="p">,</span>
</span><span class='line'>         <span class="nx">tile</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
</span><span class='line'>         <span class="s1">&#39;&amp;type=jpg&#39;</span><span class="p">,</span>
</span><span class='line'>         <span class="s1">&#39;&amp;fill=ffffff&#39;</span><span class="p">,</span>
</span><span class='line'>         <span class="s1">&#39;&amp;transparent=true&#39;</span><span class="p">,</span>
</span><span class='line'>         <span class="s1">&#39;&amp;cache=true&#39;</span><span class="p">,</span>
</span><span class='line'>         <span class="s1">&#39;&amp;quality=60&#39;</span><span class="p">,</span>
</span><span class='line'>         <span class="s1">&#39;&amp;ts=256&#39;</span><span class="p">,</span>
</span><span class='line'>         <span class="s1">&#39;&amp;srs=EPSG:4326&#39;</span>
</span><span class='line'>        <span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="nx">captures</span> <span class="o">&amp;&amp;</span> <span class="nx">captures</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="p">){</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="s1">&#39;QString: &#39;</span> <span class="p">);</span>
</span><span class='line'>  <span class="c1">//Test qString for url parameters, otherwise we need tile nouns to find the map tile</span>
</span><span class='line'>  <span class="nx">qstring</span> <span class="o">=</span> <span class="nx">captures</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//Fail, what to do</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//get http://iws.erdas.com/ImageX/imagex.dll?image?cache=true&amp;transparent=true&amp;fill=ffffff&amp;quality=60&amp;type=jpg&amp;l=2&amp;tx=2&amp;ty=1&amp;ts=256&amp;layers=/sampleiws/images/geodetic/usademo.ecw&amp;srs=EPSG:4326</span>
</span><span class='line'>    <span class="nx">req</span><span class="p">.</span><span class="nx">url</span> <span class="o">=</span> <span class="s1">&#39;/ImageX/imagex.dll?image?layers=&#39;</span> <span class="o">+</span> <span class="nx">layer</span> <span class="o">+</span> <span class="nx">qstring</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">req</span><span class="p">.</span><span class="nx">url</span> <span class="p">);</span>
</span><span class='line'>    <span class="nx">proxy</span><span class="p">.</span><span class="nx">proxyRequest</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="s1">&#39;iws.erdas.com&#39;</span><span class="p">,</span> <span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>QED</p>
</div>
  
  


    </article>
  
  <nav class="pagination">
    <div>
      
        <a class="prev" href="/blog/page/2/">&larr; Older</a>
      
      <a href="/blog/archives">Blog Archives</a>
      
    </div>
  </nav>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2011/my-adventures-into-webgl/">My adventures into WebGL</a>
      </li>
    
      <li class="post">
        <a href="/2011/jodoc-js/">jodoc-js</a>
      </li>
    
      <li class="post">
        <a href="/2011/testing-for-optional-false-params-in-javascript/">Testing for optional false params in JavaScript</a>
      </li>
    
      <li class="post">
        <a href="/2011/github/">Github</a>
      </li>
    
      <li class="post">
        <a href="/2011/hp-pavilion-dv6-quad-edition/">HP Pavilion dv6 Quad Edition</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Github Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/drewwells">@drewwells</a> on Github
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'drewwells',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("coldfuser", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/coldfuser" class="twitter-follow-button" data-width="208px" data-show-count="false">Follow @coldfuser</a>
  
</section>



  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2011 - Drew Wells -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
    var disqus_shortname = 'drewwells';

      
        
        var disqus_script = 'count.js';
      

    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>



  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-2783646-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>





</body>
</html>
